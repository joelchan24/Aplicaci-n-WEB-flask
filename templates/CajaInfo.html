{% include "Header.html" %}

                <!-- ===============emcabezado del conteiner============== -->
              
                <div class="row page-titles">
                    <div class="col-md-5 align-self-center">
                        <h3 class="text-themecolor">Caja </h3>
                        <ol class="breadcrumb">
                         
                        </ol>
                    </div>
                    <div style="padding-left: 500px; text-align: right 220px;">

                </div>
                </div>
                <div class="row">
                        <!-- Start Notification -->
                        <div class="col-lg-6 col-md-12">
                                <div class="card">
                                        <div class="card-body">
                                        <!--<h5 class="card-title">Historial</h5>
                                            <ul class="feeds">
                                                <li>
                                                    <div class="bg-light-info"><i class="fa fa-bell-o"></i></div>Cambios recientes<span class="text-muted">Hace un momento</span></li>
                                                <li>
                                                    <div class="bg-light-success"><i class="fa fa-server"></i></div> Agua renovada<span class="text-muted">Hace 2 horas</span></li>
                                                <li>
                                                    <div class="bg-light-warning"><i class="fa fa-shopping-cart"></i></div> Comportamiento<span class="text-muted">01 Julio</span></li>
                                                <li>
                                                    <div class="bg-light-danger"><i class="fa fa-user"></i></div> Revisión<span class="text-muted">01 Julio</span></li>
                                              
                                            </ul>  -->   
                                            <div class="table-responsive">
                                                <table id="tblUsuarios" class="table">
                                                    <thead>
                                                        <tr>
                                                            <th hidden>ID</th>
                                                           
                                                            <th>Fecha Visitas</th>
                                                            <th>Usuario</th>
                                                            <th>Número de caja</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% for item in data2 %}
                                                        <tr>
                                                                <td>{{item.fecha}}</td>
                                                                <td>{{item.usuario}}</td>
                                                                <td>{{item.numeroCaja}}</td>
                                                        </tr>
                                                        {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>  
                                        </div>
                                </div>
                        </div>
                       
                        <div class="col-lg-6">
                                <div class="card">
                                        <div class="card-body" style="align-self: center;">
                                            <div class="d-flex m-b-30 no-block">
                                                <h5 class="card-title m-b-0 align-self-center">Revisiones</h5>
                                                <div class="ml-auto">
                                                    <select class="custom-select b-0">
                                                        <option selected="">Hoy</option>
                                                        
                                                    </select>
                                                </div>
                                            </div>
                                            <canvas id="myCanvas" style="height:300px; width:300px; text-align: center;"></canvas>
                                            <ul class="list-inline m-t-30 text-center font-12">
                                                <li><i class="fa fa-circle text-success"></i> Temperatura</li>
                                                <li><i class="fa fa-circle text-info"></i> Humedad</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                        </div>
                        <!-- End Feeds -->
                </div>
              
               
                <div class="row">
                        <div class="col-lg-3">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="d-flex m-b-30 no-block">
                                            <h5 class="card-title m-b-0 align-self-center">Estado</h5>
                                            <div class="ml-auto">
                                            </div>
                                        </div>
                                        {% for item in data %}
                                        <div id="" style="height:100px; width:100%;">Saludable</div>{% endfor %}
                                        <ul class="list-inline m-t-30 text-center font-12">
                                            <li><i class="fa fa-circle text-success"></i> </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                                <div class="col-lg-3">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="d-flex m-b-30 no-block">
                                            <h5 class="card-title m-b-0 align-self-center">Temperatura</h5>
                                            <div class="ml-auto">
                                            </div>
                                        </div>
                                        {% for item in data %}
                                        <div id="id" name="id" hidden style="height:100px; width:100%;">{{caja}}</div>
                                        <div id="temperatura" name="temperatura" style="height:100px; width:100%;">{{item.temperatura}}</div>{% endfor %}
                                        <ul class="list-inline m-t-30 text-center font-12">
                                            <li><i class="fa fa-circle text-info"></i> </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-3">
                                    <div class="card">
                                        <div class="card-body">
                                            <div class="d-flex m-b-30 no-block">
                                                <h5 class="card-title m-b-0 align-self-center">Humedad</h5>
                                                <div class="ml-auto">
                                                </div>
                                            </div>
                                            {% for item in data %}
                                            <div id="humedad" name="humedad" style="height:100px; width:100%;">{{item.humedad}}</div>{% endfor %}
                                            <ul class="list-inline m-t-30 text-center font-12">
                                                <li><i class="fa fa-circle text-success"></i> </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
        
                                <div class="col-lg-3">
                                        <div class="card">
                                            <div class="card-body">
                                                <div class="d-flex m-b-30 no-block">
                                                    <h5 class="card-title m-b-0 align-self-center">Sonido</h5>
                                                    <div class="ml-auto">
                                                    </div>
                                                </div>
                                                {% for item in data %}
                                                <div id="" style="height:100px; width:100%;">{{item.sonido}}</div>{% endfor %}
                                                <ul class="list-inline m-t-30 text-center font-12">
                                                    <li><i class="fa fa-circle text-success"></i> </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                            </div>

                <!-- =============End PAge Content=================== -->
                <div class="row">
                    <!-- Start Notification -->
                    <div class="col-lg-6 col-md-12">
                            <div class="card">
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table id="tblUsuarios" class="table">
                                                <thead>
                                                    <tr>
                                                        <th></th>
                                                        <th><h3><b>Visitas</b></h3></th>
                                                        <th><h3><b>Anteriores</b></h3></th>
                                                    </tr>
                                                    <tr>
                                                        <th hidden>ID</th>
                                                       
                                                        <th>Temperatura</th>
                                                        <th>Humedad</th>
                                                        <th>Sonido</th>
                                                        <th>Fecha</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for item in data3 %}
                                                    <tr>
                                                            <td>{{item.temperatura}}</td>
                                                            <td>{{item.humedad}}</td>
                                                            <td>{{item.sonido}}</td>
                                                            <td>{{item.fecha}}</td>
                                                    </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>  
                                    </div>
                            </div>
                    </div>

                    <div class="col-lg-6">
                            <div class="card">
                                    <div class="card-body" style="align-self: center;">
                                        <div class="d-flex m-b-30 no-block">
                                            <h5 class="card-title m-b-0 align-self-center">Revisiones</h5>
                                            <div class="ml-auto">
                                                <select class="custom-select b-0">
                                                    <option selected=""></option>
                                                    
                                                </select>
                                            </div>
                                        </div>
                                        <canvas id="myPastel" ></canvas>
                                        <legend for="myLegend"></legend>
                                        
                                    </div>
                                </div>
                            </div>
                    </div>
                    </div>
                 

 
        <script type="text/javascript" >
 Window.onload = function() {
   var myCanvas = document.getElementById("myPastel");
       var array=[];
       $.ajax({
           url: 'http://127.0.0.1:3000/monitoreoGrafica',
           dataType: 'json',
           type: 'POST',
           headers: {'Access-Control-Allow-Origin': 'http://127.0.0.1:3000/monitoreoGrafica'},
           contentType: 'application/json',
           crossDomain: true,
           data:JSON.stringify({"idCaja":idCaja}) ,
           processData: true,
           success: function (data, textStatus, jQxhr) {
            
               array.push( { "Temperatura": 14.2,"Humedad": 151,"Sonido": 62
})
               alert("dd");
              // $('#response pre').html(JSON.stringify(data));
              alert(data[0])
           },
           error: function (jqXhr, textStatus, errorThrown) {
               console.log(errorThrown);
               alert(errorThrown);
           }
       });
   };



//Gráfica de Pastel
var myCanvas = document.getElementById("myPastel");
myCanvas.width = 300;
myCanvas.height = 300;
  
var ctx = myCanvas.getContext("2d");
function drawLine(ctx, startX, startY, endX, endY,color){
    ctx.save();
    ctx.strokeStyle = color;
    ctx.beginPath();
    ctx.moveTo(startX,startY);
    ctx.lineTo(endX,endY);
    ctx.stroke();
    ctx.restore();
}
function drawBar(ctx, upperLeftCornerX, upperLeftCornerY, width, height,color){
    ctx.save();
    ctx.fillStyle=color;
    ctx.fillRect(upperLeftCornerX,upperLeftCornerY,width,height);
    ctx.restore();
}
var myVinyls = {
    "Temperatura": 14.2,
    "Humedad": 151,
    "Sonido": 62
};

var Barchart = function(options){
    this.options = options;
    this.canvas = options.canvas;
    this.ctx = this.canvas.getContext("2d");
    this.colors = options.colors;
  
    this.draw = function(){
        var maxValue = 0;
        for (var categ in this.options.data){
            maxValue = Math.max(maxValue,this.options.data[categ]);
        }
        var canvasActualHeight = this.canvas.height - this.options.padding * 2;
        var canvasActualWidth = this.canvas.width - this.options.padding * 2;
 
        //drawing the grid lines
        var gridValue = 0;
        while (gridValue <= maxValue){
            var gridY = canvasActualHeight * (1 - gridValue/maxValue) + this.options.padding;
            drawLine(
                this.ctx,
                0,
                gridY,
                this.canvas.width,
                gridY,
                this.options.gridColor
            );
             
            //writing grid markers
            this.ctx.save();
            this.ctx.fillStyle = this.options.gridColor;
            this.ctx.font = "bold 10px Arial";
            this.ctx.fillText(gridValue, 10,gridY - 2);
            this.ctx.restore();
 
            gridValue+=this.options.gridScale;
        }
  
        //drawing the bars
        var barIndex = 0;
        var numberOfBars = Object.keys(this.options.data).length;
        var barSize = (canvasActualWidth)/numberOfBars;
 
        for (categ in this.options.data){
            var val = this.options.data[categ];
            var barHeight = Math.round( canvasActualHeight * val/maxValue) ;
            drawBar(
                this.ctx,
                this.options.padding + barIndex * barSize,
                this.canvas.height - barHeight - this.options.padding,
                barSize,
                barHeight,
                this.colors[barIndex%this.colors.length]
            );
 
            barIndex++;
        }
  //drawing series name
this.ctx.save();
this.ctx.textBaseline="bottom";
this.ctx.textAlign="center";
this.ctx.fillStyle = "#000000";
this.ctx.font = "bold 14px Arial";
this.ctx.fillText(this.options.seriesName, this.canvas.width/2,this.canvas.height);
this.ctx.restore(); 

//draw legend
        barIndex = 0;
        var legend = document.querySelector("legend[for='myLegend']");
        var ul = document.createElement("ul");
        legend.append(ul);
        for (categ in this.options.data){
            var li = document.createElement("li");
            li.style.font="bold 14px Arial";
            li.style.listStyle = "none";
            li.style.borderLeft = "5px solid "+this.colors[barIndex%this.colors.length];
            li.style.padding = "5px";
            li.textContent = categ;
            ul.append(li);
            barIndex++;}
    }
}


var myBarchart = new Barchart(
    {
        canvas:myCanvas,
        seriesName:"Besoft",
        padding:20,
        gridScale:5,
        gridColor:"#eeeeee",
        data:myVinyls,
        colors:["#7D7C7C","#67b6c7", "#7D7C7C","#67b6c7"]
    }
);



//Gráfica de Dona
    var myCanvas = document.getElementById("myCanvas");
       
      myCanvas.width = 300;
       
      myCanvas.height = 300;
       
       
       
      var ctx = myCanvas.getContext("2d");
      
      
      function drawLine(ctx, startX, startY, endX, endY){
       
          ctx.beginPath();
       
          ctx.moveTo(startX,startY);
       
          ctx.lineTo(endX,endY);
       
          ctx.stroke();
       
      }
      
      function drawArc(ctx, centerX, centerY, radius, startAngle, endAngle){
       
          ctx.beginPath();
       
          ctx.arc(centerX, centerY, radius, startAngle, endAngle);
       
          ctx.stroke();
       
      }
      
      function drawPieSlice(ctx,centerX, centerY, radius, startAngle, endAngle, color ){
       
          ctx.fillStyle = color;
       
          ctx.beginPath();
       
          ctx.moveTo(centerX,centerY);
       
          ctx.arc(centerX, centerY, radius, startAngle, endAngle);
       
          ctx.closePath();
       
          ctx.fill();
       
      }
      
      var Temperatura = document.getElementById("temperatura").innerHTML;
      var Humedad = document.getElementById("humedad").innerHTML;
      var myVinyls = {
                    "Temperatura": parseInt(Temperatura),

                    "Huemdad": parseInt(Humedad)

                    };
      
      var Piechart = function(options){
       
          this.options = options;
       
          this.canvas = options.canvas;
       
          this.ctx = this.canvas.getContext("2d");
       
          this.colors = options.colors;
         
          this.draw = function(){
       
              var total_value = 0;
       
              var color_index = 0;
       
              for (var categ in this.options.data){
       
                  var val = this.options.data[categ];
       
                  total_value += val;
       
              }
       
       
       
              var start_angle = 0;
       
              for (categ in this.options.data){
       
                  val = this.options.data[categ];
       
                  var slice_angle = 2 * Math.PI * val / total_value;
       
       
       
                  drawPieSlice(
       
                      this.ctx,
       
                      this.canvas.width/2,
       
                      this.canvas.height/2,
       
                      Math.min(this.canvas.width/2,this.canvas.height/2),
       
                      start_angle,
       
                      start_angle+slice_angle,
       
                      this.colors[color_index%this.colors.length]
       
                  );
       
       
       
                  start_angle += slice_angle;
       
                  color_index++;
       
              }
       
       
       
              //drawing a white circle over the chart
       
              //to create the doughnut chart
       
              if (this.options.doughnutHoleSize){
       
                  drawPieSlice(
       
                      this.ctx,
       
                      this.canvas.width/2,
       
                      this.canvas.height/2,
       
                      this.options.doughnutHoleSize * Math.min(this.canvas.width/2,this.canvas.height/2),
       
                      0,
       
                      2 * Math.PI,
       
                      "#ffffff"
       
                  );
       
              }
       
       
       
          }
       
      }
      var myDougnutChart = new Piechart(
       
          {
       
              canvas:myCanvas,
       
              data:myVinyls,
       
              colors:["#57d9ff","#937e88"],
       
              doughnutHoleSize:0.7
       
          }
       
      );
      var idPrueba = document.getElementById("id").innerHTML;
       //alert(idPrueba);
      myDougnutChart.draw();
      myBarchart.draw();
        </script>
       
               
{% extends "footer.html" %}    